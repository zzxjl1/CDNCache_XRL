<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Charts</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.4.2/echarts.min.js"></script>
    <script src="/global.js"></script>
</head>

<body style="margin: 0;">
    <div id="main" style="width: 100vw;height:100vh;"></div>
    <script type="text/javascript">

        let result = [];
        let url = '/' + getUrlParam('url');
        let name = parse_name(url);
        let type = getUrlParam('type');

        function get_data() {
            ajaxGet(url, function (data) {
                result = [];
                for (let i = 0; i < data.length; i++) {
                    result.push(
                        {
                            value: [i, data[i]]
                        });
                }
                myChart.setOption({
                    series: [
                        {
                            data: result
                        }
                    ]
                });
            });
        }

        function append_data() {
            ajaxGet(url, function (data) {

                result.push(
                    {
                        value: [result.length, data]
                    });

                myChart.setOption({
                    series: [
                        {
                            data: result
                        }
                    ]
                });
            });
        }


        var chartDom = document.getElementById('main');
        var myChart = echarts.init(chartDom);

        var option = {
            title: {
                text: name,
                left: 'center',
            },
            tooltip: {
                trigger: 'axis',
                formatter: function (params) {
                    params = params[0];
                    return (
                        params.value[1].toString()
                    );
                },
                axisPointer: {
                    animation: false
                }
            },
            xAxis: {
                type: 'value',
                splitLine: {
                    show: false
                }
            },
            yAxis: {
                type: 'value',
                boundaryGap: [0, '100%'],
                splitLine: {
                    show: false
                }
            },
            series: [
                {
                    type: 'line',
                    showSymbol: false,
                    data: result
                }
            ]
        };

        setInterval(function () {
            switch (type) {
                case 'append':
                    append_data();
                    break;
                case 'get':
                    get_data();
                    break;
                default:
                    break;
            }
        }, 1000);

        myChart.setOption(option);
    </script>
</body>

</html>